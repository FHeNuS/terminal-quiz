var TerminalQuiz;!function(t){var e=function(){function e(t,e){this.name=t,this.quiz=e}return e.prototype.initialize=function(){},e.prototype._getParsedText=function(){return t.Quiz.getStringFromStringGetter(this.text)},e.prototype._getCompletionCallback=function(){return null},e.prototype._getParsedDescription=function(){return t.Quiz.getStringFromStringGetter(this.description)},e.prototype._getParsedFullText=function(){var e=t.Quiz.wrapText(this._getParsedText(),"question-text"),i=t.Quiz.wrapText(this._getParsedDescription(),"question-description");return t.Quiz.wrapText(e+i,"question",this.constructor.toString().match(/\w+/g)[1],this.name)},e.prototype._parseAnswer=function(t){var e={};e.isValid=!1;var i=t&&t.length>0;return!i&&this.required&&this.required()?this.quiz.echoFail("Please supply a value!"):i&&this.regex&&!this.regex.test(t)?this.quiz.echoFail("Supplied value does not respect pattern: "+this.friendlyRegex):(e.isValid=!0,e.parsedAnswer=t),e},e.prototype["if"]=function(t){return this.ifCallback=t,this},e.prototype.withText=function(t){return this.text=t,this},e.prototype.withPattern=function(t,e){return this.regex=t,this.friendlyRegex=e,this},e.prototype.asRequired=function(t){return void 0===t&&(t=function(){return!0}),this.required=t,this},e.prototype.onAnswer=function(t){return this.onAnswerCb=t,this},e.prototype.shouldBeAsked=function(){return this.ifCallback?this.ifCallback():!0},e.prototype.ask=function(t){var e=this;this.initialize();this._getParsedFullText();this.quiz.echo(this._getParsedFullText(),function(){e.quiz._pushQuestion(function(i){var n=e._parseAnswer(i);n.isValid&&(n.keepAlive||(e.onAnswerCb(n.parsedAnswer),e.quiz._popQuestion(),t(n.parsedAnswer)))},e._getCompletionCallback(),"> ")})},e}();t.Question=e}(TerminalQuiz||(TerminalQuiz={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},TerminalQuiz;!function(t){!function(t){t[t.ID_LABEL=0]="ID_LABEL",t[t.ID=1]="ID",t[t.LABEL=2]="LABEL"}(t.ChoiceQuestionMode||(t.ChoiceQuestionMode={}));var e=(t.ChoiceQuestionMode,function(e){function i(){e.apply(this,arguments)}return __extends(i,e),i.prototype.initialize=function(){var i=this;e.prototype.initialize.call(this),this.singleItemNameGetter||(this.singleItemNameGetter=this.name),this.description||(this.description=function(){var e="";return i.opts.forEach(function(n){var o=t.Quiz.wrap(i.nameGetter(n),"div","choice-name");i.descGetter&&(o+=t.Quiz.wrap(i.descGetter(n),"div","choice-desc")),e+=t.Quiz.wrap(o,"li","choice")}),t.Quiz.wrap(e,"ul","choices")})},i.prototype.withOptions=function(t){return this.opts=t,this},i.prototype.singleItemName=function(t){return this.singleItemNameGetter=t,this},i.prototype.getSingleItemName=function(){return t.Quiz.getStringFromStringGetter(this.singleItemNameGetter)},i.prototype.optionName=function(t){return this.nameGetter=t,this},i.prototype.optionDescription=function(t){return this.descGetter=t,this},i.prototype.withText=function(t){return e.prototype.withText.call(this,t)},i.prototype.onAnswer=function(t){return e.prototype.onAnswer.call(this,t)},i.prototype._getCompletionCallback=function(){var t=this;return function(e,i){i(t.opts.map(function(e){return t.nameGetter(e)}))}},i.prototype._parseAnswer=function(t){var i=this,n=e.prototype._parseAnswer.call(this,t);if(n.isValid){var o=this.opts.filter(function(e){return i.nameGetter(e)==t});1==o.length?(n.isValid=!0,n.parsedAnswer=o[0]):(n.isValid=!1,this.quiz.echoFail("Invalid choice of "+this.getSingleItemName()+"!"))}return n},i}(t.Question));t.ChoiceQuestion=e}(TerminalQuiz||(TerminalQuiz={}));var TerminalQuiz;!function(t){var e=function(e){function i(){e.apply(this,arguments)}return __extends(i,e),i.prototype.ofQuestion=function(t){return this.question=t,this},i.prototype.initialize=function(){var i=this;e.prototype.initialize.call(this),this.answers=new Array,this.question.initialize(),this.description||(this.description=function(){var e=t.Quiz.wrapText(i.question._getParsedFullText(),"list-inner-question"),n="";return n+=t.Quiz.wrap(t.Quiz.wrapText("add "+i.question.name,"list-cmd-name")+t.Quiz.wrapText("Adds the supplied value.","list-cmd-desc"),"li"),n+=t.Quiz.wrap(t.Quiz.wrapText("rem "+i.question.name,"list-cmd-name")+t.Quiz.wrapText("Removes the suplied value.","list-cmd-desc"),"li"),n+=t.Quiz.wrap(t.Quiz.wrapText("list","list-cmd-name")+t.Quiz.wrapText("List the current values.","list-cmd-desc"),"li"),n+=t.Quiz.wrap(t.Quiz.wrapText("done","list-cmd-name")+t.Quiz.wrapText("Finishes list edition.","list-cmd-desc"),"li"),e+t.Quiz.wrap(n,"ul","list-cmds")})},i.prototype.onAnswer=function(t){return e.prototype.onAnswer.call(this,t)},i.prototype._getCompletionCallback=function(){var t=this;return function(e,i){var n=t.quiz._getCommands();1==n.length?i(["add","rem","list","done"]):t.question._getCompletionCallback()(e,i)}},i.prototype._parseAnswer=function(e){var i={};i.keepAlive=!0,i.isValid=!0;var n=e.split(t.Quiz.CMD_SEPARATOR);switch(n[0]){case"add":var o=n.slice(1).join(t.Quiz.CMD_SEPARATOR),r=this.question._parseAnswer(o);i.isValid=r.isValid,r.isValid&&(this.answers.push(r.parsedAnswer),this.quiz.echoSuccess(o+" added!"));break;case"rem":break;case"list":break;case"done":i.parsedAnswer=this.answers,i.keepAlive=!1}return i},i}(t.Question);t.ListQuestion=e}(TerminalQuiz||(TerminalQuiz={}));var TerminalQuiz;!function(t){var e=function(e){function i(){e.apply(this,arguments),this.questions=new Array,this.showFormat=!0,this.showQuestions=!0}return __extends(i,e),i.prototype.onAnswer=function(t){return e.prototype.onAnswer.call(this,t)},i.prototype.withText=function(t){return e.prototype.withText.call(this,t)},i.prototype.hideCombinationFormat=function(){return this.showFormat=!1,this},i.prototype.hideQuestionsDescription=function(){return this.showQuestions=!1,this},i.prototype.withQuestions=function(t){return this.questions=t,this},i.prototype._parseAnswer=function(e){var i=this,n={},o=e.split(t.Quiz.CMD_SEPARATOR);if(o.length!=this.questions.length)n.isValid=!1,this.quiz.echoFail("Wrong answer format!");else{n.isValid=!0;var r=new Array;o.forEach(function(t,e){var o=i.questions[e]._parseAnswer(t);o.isValid?r.push(o.parsedAnswer):n.isValid=!1}),n.parsedAnswer=r}return n},i.prototype._getCompletionCallback=function(){var t=this;return function(e,i){var n=t.quiz._getCommands();if(n=n.slice(t.quiz._getNestedLevel()-1),n.length<=t.questions.length){var o=n.length-1;t.questions[o]._getCompletionCallback()(e,i)}else i([])}},i.prototype.initialize=function(){var i=this;e.prototype.initialize.call(this),this.questions.forEach(function(t){t.initialize()}),this.description||(this.description=function(){var e="";i.showFormat&&(i.questions.forEach(function(i,n){e+=t.Quiz.wrapText(i._getParsedText(),"combination-format-question")}),e=t.Quiz.wrapText(e,"combination-format"));var n="";return i.showQuestions&&(i.questions.forEach(function(e,i){n+=t.Quiz.wrap(e._getParsedFullText(),"li","conbination-question")}),n=t.Quiz.wrap(n,"ul","combination-questions")),n+e})},i}(t.Question);t.CombinationQuestion=e}(TerminalQuiz||(TerminalQuiz={}));var TerminalQuiz;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.onAnswer=function(e){return t.prototype.onAnswer.call(this,e)},e.prototype.withText=function(e){return t.prototype.withText.call(this,e)},e.prototype.asRequired=function(e){return t.prototype.asRequired.call(this,e)},e}(t.Question);t.TextQuestion=e}(TerminalQuiz||(TerminalQuiz={}));var TerminalQuiz;!function(t){var e=function(){function e(t,e){var i=this;this.element=t,this.opts=e,this.questions=new Array,this.anim=!1,this.echo=this.typed(function(t,e){i.term.set_command(""),i.term.set_prompt(e)}),this.audioLoopHash=[],this.audioLoopCounter=[],this.backgroundAudio=this.createAudioElement(e.backgroundSoundUrl),this.typingAudio=this.createAudioElement(e.tipyingSoundUrl),this.rightAudio=this.createAudioElement(e.rightAnswerSoundUrl),this.wrongAudio=this.createAudioElement(e.wrongAnswerSoundUrl),this.shouldPlayBackground=void 0===e.playBackground||e.playBackground}return e.wrapText=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];return e.wrap.apply(e,[t,"div"].concat(i))},e.wrap=function(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];var o="<"+e;return i&&(o+=' class="',o+=i.join(" "),o+='">'),o+=t+"</"+e+">"},e.getStringFromStringGetter=function(t){var e="";return t&&(e="string"==typeof t?t:t()),e},e.prototype.createAudioElement=function(t){var e=document.createElement("audio");return e.src=t,document.body.appendChild(e),e},e.prototype.separateTextFromElements=function(t,e){if(t.hasChildNodes)for(var i=0;i<t.childNodes.length;i++){var n=t.childNodes[i];3==n.nodeType&&n.textContent.trim().length>0&&(e.push({elem:n,text:n.textContent}),n.textContent=""),this.separateTextFromElements(n,e)}},e.prototype.typed=function(t){var e=this;return function(i,n){var o=e.term.get_prompt();if(e.opts.typeMessageDelay>0){e.anim=!0;var r=!1;if(i.length>0){e.term.set_prompt("");var s=$("<div>").html(i),u=[];e.separateTextFromElements(s.get(0),u),e.term.echo("<i/>",{raw:!0,finalize:function(a){if(r)a.append(s);else{r=!0,e.playAudio(e.typingAudio,!0),a.empty(),a.append(s);var p=0,c=0,h=null,l=null,d=null,m=setInterval(function(){h=u[c],l=h.elem,d=h.text,l.textContent+=h.text[p++],p==d.length&&(c++,p=0,c==u.length&&(clearInterval(m),setTimeout(function(){e.stopAudio(e.typingAudio),t(i,o),e.anim=!1,n&&n()},e.opts.typeMessageDelay)))},e.opts.typeMessageDelay)}}})}}else t(i,o),n()}},e.prototype.setGreetings=function(t){this.greetings=t},e.prototype.addQuestion=function(t){return this.questions.push(t),t},e.prototype.echoFail=function(t){this.echo(e.wrapText(t,"echo-fail")),this.playAudio(this.wrongAudio)},e.prototype.echoSuccess=function(t){this.echo(e.wrapText(t,"echo-success"))},e.prototype.addTextQuestion=function(e){return this.addQuestion(new t.TextQuestion(e,this))},e.prototype.addListQuestion=function(e,i){var n=this.addQuestion(new t.ListQuestion(e,this).ofQuestion(i));return this.questions.splice(this.questions.indexOf(i),1),n},e.prototype.combinedQuestion=function(e){for(var i=this,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];return n.forEach(function(t){i.questions.splice(i.questions.indexOf(t),1)}),this.addQuestion(new t.CombinationQuestion(e,this).withQuestions(n))},e.prototype.addChoiceQuestion=function(e){return this.addQuestion(new t.ChoiceQuestion(e,this))},e.prototype.playBackgroundMusic=function(){this.shouldPlayBackground||(this.playAudio(this.backgroundAudio,!0),this.shouldPlayBackground=!0)},e.prototype.muteBackgroundMusic=function(){this.shouldPlayBackground&&(this.stopAudio(this.backgroundAudio),this.shouldPlayBackground=!1)},e.prototype.end=function(){this.stopAudio(this.backgroundAudio),this.term.clear(),this.term.set_prompt("> "),this.opts.onEnd()},e.prototype.start=function(){var t=this;this.term=window.$(this.element).terminal(function(e,i){if("start"==e)if(t.shouldPlayBackground&&t.playAudio(t.backgroundAudio,!0),i.clear(),t.questions&&t.questions.length>0){var n=0,o=t.questions.length,r=t.questions[n],s=function(){r.shouldBeAsked()&&t.opts.onAnswer&&t.opts.onAnswer(r),n++,o>n?(r=t.questions[n],r.shouldBeAsked()?r.ask(s):s()):t.end()};r.ask(s)}else t.end();else t.echoFail("unknown command")},{name:"xxx",keydown:function(e){return t.anim?!1:void 0},greetings:function(t){t("")},completion:!0,checkArity:!1}),this.echo(this.opts.greetings)},e.prototype._getCommandString=function(){return this.term.get_command()},e.prototype._getCommands=function(){return this.term.get_command().split(e.CMD_SEPARATOR)},e.prototype._getNestedLevel=function(){return this.term.level()},e.prototype._pushQuestion=function(t,e,i){var n={prompt:"> "};e&&(n.completion=function(t,i,n){e(i,n)}),this.term.push(t,n)},e.prototype._popQuestion=function(){this.playAudio(this.rightAudio),this.term.clear(),this.term.pop()},e.prototype.playAudio=function(t,e){if(void 0===e&&(e=!1),e)if(this.audioLoopHash[t.src])this.audioLoopCounter[t.src]++;else{var i=function(){this.currentTime=0,this.play()};this.audioLoopHash[t.src]=i,this.audioLoopCounter[t.src]=1,t.addEventListener("ended",i,!1),t.play()}else t.play()},e.prototype.stopAudio=function(t){1==this.audioLoopCounter[t.src]?(t.pause(),t.currentTime=0,t.removeEventListener("ended",this.audioLoopHash[t.src],!1),this.audioLoopHash[t.src]=null):this.audioLoopCounter[t.src]--},e.CMD_SEPARATOR=" ",e}();t.Quiz=e}(TerminalQuiz||(TerminalQuiz={}));