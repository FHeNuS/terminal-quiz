var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},TerminalQuiz;!function(t){!function(t){t[t.ID_LABEL=0]="ID_LABEL",t[t.ID=1]="ID",t[t.LABEL=2]="LABEL"}(t.ChoiceQuestionMode||(t.ChoiceQuestionMode={}));var e=(t.ChoiceQuestionMode,function(e){function i(){e.apply(this,arguments)}return __extends(i,e),i.prototype.initialize=function(){var i=this;e.prototype.initialize.call(this),this.singleItemNameGetter||(this.singleItemNameGetter=this.name),this.description||(this.description=function(){var e="";return i.opts.forEach(function(n){var o=t.Quiz.wrap(i.nameGetter(n),"div","choice-name");i.descGetter&&(o+=t.Quiz.wrap(i.descGetter(n),"div","choice-desc")),e+=t.Quiz.wrap(o,"li","choice")}),t.Quiz.wrap(e,"ul","choices")})},i.prototype.withOptions=function(t){return this.opts=t,this},i.prototype.singleItemName=function(t){return this.singleItemNameGetter=t,this},i.prototype.getSingleItemName=function(){return t.Quiz.getStringFromStringGetter(this.singleItemNameGetter)},i.prototype.optionName=function(t){return this.nameGetter=t,this},i.prototype.optionDescription=function(t){return this.descGetter=t,this},i.prototype.withText=function(t){return e.prototype.withText.call(this,t)},i.prototype.onAnswer=function(t){return e.prototype.onAnswer.call(this,t)},i.prototype._getCompletionCallback=function(){var t=this;return function(e,i){i(t.opts.map(function(e){return t.nameGetter(e)}))}},i.prototype._parseAnswer=function(t){var i=this,n=e.prototype._parseAnswer.call(this,t);if(n.isValid){var o=this.opts.filter(function(e){return i.nameGetter(e)==t});1==o.length?(n.isValid=!0,n.parsedAnswer=o[0]):(n.isValid=!1,this.quiz.echoFail("Invalid choice of "+this.getSingleItemName()+"!"))}return n},i}(t.Question));t.ChoiceQuestion=e}(TerminalQuiz||(TerminalQuiz={}));
var __extends=this&&this.__extends||function(t,i){function n(){this.constructor=t}for(var o in i)i.hasOwnProperty(o)&&(t[o]=i[o]);t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)},TerminalQuiz;!function(t){var i=function(i){function n(){i.apply(this,arguments),this.questions=new Array,this.showFormat=!0,this.showQuestions=!0}return __extends(n,i),n.prototype.onAnswer=function(t){return i.prototype.onAnswer.call(this,t)},n.prototype.withText=function(t){return i.prototype.withText.call(this,t)},n.prototype.hideCombinationFormat=function(){return this.showFormat=!1,this},n.prototype.hideQuestionsDescription=function(){return this.showQuestions=!1,this},n.prototype.withQuestions=function(t){return this.questions=t,this},n.prototype._parseAnswer=function(i){var n=this,o={},e=i.split(t.Quiz.CMD_SEPARATOR);if(e.length!=this.questions.length)o.isValid=!1,this.quiz.echoFail("Wrong answer format!");else{o.isValid=!0;var s=new Array;e.forEach(function(t,i){var e=n.questions[i]._parseAnswer(t);e.isValid?s.push(e.parsedAnswer):o.isValid=!1}),o.parsedAnswer=s}return o},n.prototype._getCompletionCallback=function(){var t=this;return function(i,n){var o=t.quiz._getCommands();if(o=o.slice(t.quiz._getNestedLevel()-1),o.length<=t.questions.length){var e=o.length-1;t.questions[e]._getCompletionCallback()(i,n)}else n([])}},n.prototype.initialize=function(){var n=this;i.prototype.initialize.call(this),this.questions.forEach(function(t){t.initialize()}),this.description||(this.description=function(){var i="";n.showFormat&&(n.questions.forEach(function(n,o){i+=t.Quiz.wrapText(n._getParsedText(),"combination-format-question")}),i=t.Quiz.wrapText(i,"combination-format"));var o="";return n.showQuestions&&(n.questions.forEach(function(i,n){o+=t.Quiz.wrap(i._getParsedFullText(),"li","conbination-question")}),o=t.Quiz.wrap(o,"ul","combination-questions")),o+i})},n}(t.Question);t.CombinationQuestion=i}(TerminalQuiz||(TerminalQuiz={}));
var __extends=this&&this.__extends||function(e,i){function t(){this.constructor=e}for(var s in i)i.hasOwnProperty(s)&&(e[s]=i[s]);e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)},TerminalQuiz;!function(e){var i=function(i){function t(){i.apply(this,arguments)}return __extends(t,i),t.prototype.ofQuestion=function(e){return this.question=e,this},t.prototype.initialize=function(){var t=this;i.prototype.initialize.call(this),this.answers=new Array,this.question.initialize(),this.description||(this.description=function(){var i=e.Quiz.wrapText(t.question._getParsedFullText(),"list-inner-question"),s="";return s+=e.Quiz.wrap(e.Quiz.wrapText("add "+t.question.name,"list-cmd-name")+e.Quiz.wrapText("Adds the supplied value.","list-cmd-desc"),"li"),s+=e.Quiz.wrap(e.Quiz.wrapText("rem "+t.question.name,"list-cmd-name")+e.Quiz.wrapText("Removes the suplied value.","list-cmd-desc"),"li"),s+=e.Quiz.wrap(e.Quiz.wrapText("list","list-cmd-name")+e.Quiz.wrapText("List the current values.","list-cmd-desc"),"li"),s+=e.Quiz.wrap(e.Quiz.wrapText("done","list-cmd-name")+e.Quiz.wrapText("Finishes list edition.","list-cmd-desc"),"li"),i+e.Quiz.wrap(s,"ul","list-cmds")})},t.prototype.onAnswer=function(e){return i.prototype.onAnswer.call(this,e)},t.prototype._getCompletionCallback=function(){var e=this;return function(i,t){var s=e.quiz._getCommands();1==s.length?t(["add","rem","list","done"]):e.question._getCompletionCallback()(i,t)}},t.prototype._parseAnswer=function(i){var t={};t.keepAlive=!0,t.isValid=!0;var s=i.split(e.Quiz.CMD_SEPARATOR);switch(s[0]){case"add":var n=s.slice(1).join(e.Quiz.CMD_SEPARATOR),r=this.question._parseAnswer(n);t.isValid=r.isValid,r.isValid&&(this.answers.push(r.parsedAnswer),this.quiz.echoSuccess(n+" added!"));break;case"rem":break;case"list":break;case"done":t.parsedAnswer=this.answers,t.keepAlive=!1}return t},t}(e.Question);e.ListQuestion=i}(TerminalQuiz||(TerminalQuiz={}));
var TerminalQuiz;!function(t){var e=function(){function e(t,e){this.name=t,this.quiz=e}return e.prototype.initialize=function(){},e.prototype._getParsedText=function(){return t.Quiz.getStringFromStringGetter(this.text)},e.prototype._getCompletionCallback=function(){return null},e.prototype._getParsedDescription=function(){return t.Quiz.getStringFromStringGetter(this.description)},e.prototype._getParsedFullText=function(){var e=t.Quiz.wrapText(this._getParsedText(),"question-text"),i=t.Quiz.wrapText(this._getParsedDescription(),"question-description");return t.Quiz.wrapText(e+i,"question",this.constructor.toString().match(/\w+/g)[1],this.name)},e.prototype._parseAnswer=function(t){var e={};e.isValid=!1;var i=t&&t.length>0;return!i&&this.required&&this.required()?this.quiz.echoFail("Please supply a value!"):i&&this.regex&&!this.regex.test(t)?this.quiz.echoFail("Supplied value does not respect pattern: "+this.friendlyRegex):(e.isValid=!0,e.parsedAnswer=t),e},e.prototype["if"]=function(t){return this.ifCallback=t,this},e.prototype.withText=function(t){return this.text=t,this},e.prototype.withPattern=function(t,e){return this.regex=t,this.friendlyRegex=e,this},e.prototype.asRequired=function(t){return void 0===t&&(t=function(){return!0}),this.required=t,this},e.prototype.onAnswer=function(t){return this.onAnswerCb=t,this},e.prototype.shouldBeAsked=function(){return this.ifCallback?this.ifCallback():!0},e.prototype.ask=function(t){var e=this;this.initialize();this._getParsedFullText();this.quiz.echo(this._getParsedFullText(),function(){e.quiz._pushQuestion(function(i){var r=e._parseAnswer(i);r.isValid&&(r.keepAlive||(e.onAnswerCb(r.parsedAnswer),e.quiz._popQuestion(),t(r.parsedAnswer)))},e._getCompletionCallback(),"> ")})},e}();t.Question=e}(TerminalQuiz||(TerminalQuiz={}));
var TerminalQuiz;!function(t){var e=function(){function e(t,e){var o=this;this.element=t,this.opts=e,this.questions=new Array,this.anim=!1,this.echo=this.typed(function(t,e){o.term.set_command(""),o.term.set_prompt(e)}),this.audioLoopHash=[],this.audioLoopCounter=[],this.backgroundAudio=this.createAudioElement(e.backgroundSoundUrl),this.typingAudio=this.createAudioElement(e.tipyingSoundUrl),this.rightAudio=this.createAudioElement(e.rightAnswerSoundUrl),this.wrongAudio=this.createAudioElement(e.wrongAnswerSoundUrl),this.shouldPlayBackground=void 0===e.playBackground||e.playBackground}return e.wrapText=function(t){for(var o=[],n=1;n<arguments.length;n++)o[n-1]=arguments[n];return e.wrap.apply(e,[t,"div"].concat(o))},e.wrap=function(t,e){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];var i="<"+e;return o&&(i+=' class="',i+=o.join(" "),i+='">'),i+=t+"</"+e+">"},e.getStringFromStringGetter=function(t){var e="";return t&&(e="string"==typeof t?t:t()),e},e.prototype.createAudioElement=function(t){var e=document.createElement("audio");return e.src=t,document.body.appendChild(e),e},e.prototype.separateTextFromElements=function(t,e){if(t.hasChildNodes)for(var o=0;o<t.childNodes.length;o++){var n=t.childNodes[o];3==n.nodeType&&n.textContent.trim().length>0&&(e.push({elem:n,text:n.textContent}),n.textContent=""),this.separateTextFromElements(n,e)}},e.prototype.typed=function(t){var e=this;return function(o,n){var i=e.term.get_prompt();if(e.opts.typeMessageDelay>0){e.anim=!0;var s=!1;if(o.length>0){e.term.set_prompt("");var r=$("<div>").html(o),u=[];e.separateTextFromElements(r.get(0),u),e.term.echo("<i/>",{raw:!0,finalize:function(a){if(s)a.append(r);else{s=!0,e.playAudio(e.typingAudio,!0),a.empty(),a.append(r);var p=0,d=0,h=null,c=null,l=null,m=setInterval(function(){h=u[d],c=h.elem,l=h.text,c.textContent+=h.text[p++],p==l.length&&(d++,p=0,d==u.length&&(clearInterval(m),setTimeout(function(){e.stopAudio(e.typingAudio),t(o,i),e.anim=!1,n&&n()},e.opts.typeMessageDelay)))},e.opts.typeMessageDelay)}}})}}else t(o,i),n()}},e.prototype.setGreetings=function(t){this.greetings=t},e.prototype.addQuestion=function(t){return this.questions.push(t),t},e.prototype.echoFail=function(t){this.echo(e.wrapText(t,"echo-fail")),this.playAudio(this.wrongAudio)},e.prototype.echoSuccess=function(t){this.echo(e.wrapText(t,"echo-success"))},e.prototype.addTextQuestion=function(e){return this.addQuestion(new t.TextQuestion(e,this))},e.prototype.addListQuestion=function(e,o){var n=this.addQuestion(new t.ListQuestion(e,this).ofQuestion(o));return this.questions.splice(this.questions.indexOf(o),1),n},e.prototype.combinedQuestion=function(e){for(var o=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return n.forEach(function(t){o.questions.splice(o.questions.indexOf(t),1)}),this.addQuestion(new t.CombinationQuestion(e,this).withQuestions(n))},e.prototype.addChoiceQuestion=function(e){return this.addQuestion(new t.ChoiceQuestion(e,this))},e.prototype.playBackgroundMusic=function(){this.shouldPlayBackground||(this.playAudio(this.backgroundAudio,!0),this.shouldPlayBackground=!0)},e.prototype.muteBackgroundMusic=function(){this.shouldPlayBackground&&(this.stopAudio(this.backgroundAudio),this.shouldPlayBackground=!1)},e.prototype.end=function(){this.stopAudio(this.backgroundAudio),this.term.clear(),this.term.set_prompt("> "),this.opts.onEnd()},e.prototype.start=function(){var t=this;this.term=window.$(this.element).terminal(function(e,o){if("start"==e)if(t.shouldPlayBackground&&t.playAudio(t.backgroundAudio,!0),o.clear(),t.questions&&t.questions.length>0){var n=0,i=t.questions.length,s=t.questions[n],r=function(){s.shouldBeAsked()&&t.opts.onAnswer&&t.opts.onAnswer(s),n++,i>n?(s=t.questions[n],s.shouldBeAsked()?s.ask(r):r()):t.end()};s.ask(r)}else t.end();else t.echoFail("unknown command")},{name:"xxx",keydown:function(e){return t.anim?!1:void 0},greetings:function(t){t("")},completion:!0,checkArity:!1}),this.echo(this.opts.greetings)},e.prototype._getCommandString=function(){return this.term.get_command()},e.prototype._getCommands=function(){return this.term.get_command().split(e.CMD_SEPARATOR)},e.prototype._getNestedLevel=function(){return this.term.level()},e.prototype._pushQuestion=function(t,e,o){var n={prompt:"> "};e&&(n.completion=function(t,o,n){e(o,n)}),this.term.push(t,n)},e.prototype._popQuestion=function(){this.playAudio(this.rightAudio),this.term.clear(),this.term.pop()},e.prototype.playAudio=function(t,e){if(void 0===e&&(e=!1),e)if(this.audioLoopHash[t.src])this.audioLoopCounter[t.src]++;else{var o=function(){this.currentTime=0,this.play()};this.audioLoopHash[t.src]=o,this.audioLoopCounter[t.src]=1,t.addEventListener("ended",o,!1),t.play()}else t.play()},e.prototype.stopAudio=function(t){1==this.audioLoopCounter[t.src]?(t.pause(),t.currentTime=0,t.removeEventListener("ended",this.audioLoopHash[t.src],!1),this.audioLoopHash[t.src]=null):this.audioLoopCounter[t.src]--},e.CMD_SEPARATOR=" ",e}();t.Quiz=e}(TerminalQuiz||(TerminalQuiz={}));
var TerminalQuiz;!function(t){var i=function(){function t(){this.text=""}return t.prototype.append=function(t){return this.text+=t,this},t.prototype.line=function(t){return t?this.text+=t+"\r\n":this.text+="\r\n",this},t.prototype.bold=function(t){return this.text+="[[b;;]",this.text+=t,this.text+="]",this},t.prototype.toString=function(){return this.text},t}();t.TextBuilder=i}(TerminalQuiz||(TerminalQuiz={}));
var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},TerminalQuiz;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.onAnswer=function(e){return t.prototype.onAnswer.call(this,e)},e.prototype.withText=function(e){return t.prototype.withText.call(this,e)},e.prototype.asRequired=function(e){return t.prototype.asRequired.call(this,e)},e}(t.Question);t.TextQuestion=e}(TerminalQuiz||(TerminalQuiz={}));